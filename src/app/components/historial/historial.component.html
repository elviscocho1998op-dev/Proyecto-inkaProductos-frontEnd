<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3 class="fw-bold mb-0">ðŸ“œ Historial de Movimientos</h3>
      <button class="btn btn-outline-primary btn-sm" (click)="cargarDatos()">
        <i class="bi bi-arrow-clockwise"></i> Actualizar
      </button>
    </div>
  
    <div class="table-responsive shadow-sm rounded">
      <table class="table table-hover align-middle bg-white mb-0">
        <thead class="table-dark">
          <tr>
            <th class="ps-3">Fecha y Hora</th>
            <th>AlmacÃ©n Origen</th>
            <th>AlmacÃ©n Destino</th>
            <th class="text-center">Estado</th>
            <th class="text-center">Detalles</th>
          </tr>
        </thead>
        <tbody>
          @for (item of listaHistorial; track item.solicitudId) {
            <tr (click)="toggleDetalle(item.solicitudId)" style="cursor: pointer;">
              <td class="ps-3 fw-medium">{{ item.fechaSolicitud | date:'dd/MM/yyyy HH:mm' }}</td>
              <td>
                <i class="bi bi-geo-alt-fill text-danger me-1"></i>
                {{ item.origen?.nombre || 'N/A' }}
              </td>
              <td>
                <i class="bi bi-box-arrow-in-right text-success me-1"></i>
                {{ item.destino?.nombre || 'N/A' }}
              </td>
              <td class="text-center">
                <span [class]="obtenerClaseEstado(item.estado)">
                  {{ item.estado }}
                </span>
              </td>
              <td class="text-center">
                <i class="bi" [ngClass]="detalleSeleccionado === item.solicitudId ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
              </td>
            </tr>
  
            @if (detalleSeleccionado === item.solicitudId) {
              <tr class="bg-light">
                <td colspan="5" class="p-0">
                  <div class="p-3 border-start border-4 border-primary ms-3 my-2 shadow-sm bg-white rounded">
                    <h6 class="fw-bold mb-3"><i class="bi bi-list-ul"></i> Productos del Movimiento:</h6>
                    <table class="table table-sm table-bordered mb-0">
                      <thead class="table-secondary">
                        <tr>
                          <th>Producto</th>
                          <th class="text-center" style="width: 150px;">Cantidad</th>
                        </tr>
                      </thead>
                      <tbody>
                        @for (det of item.detalles; track det.id) {
                          <tr>
                            <td>{{ det.producto?.nombre }} <small class="text-muted">({{ det.producto?.sku }})</small></td>
                            <td class="text-center fw-bold text-primary">{{ det.cantidad }}</td>
                          </tr>
                        }
                      </tbody>
                    </table>
                  </div>
                </td>
              </tr>
            }
          } @empty {
            <tr>
              <td colspan="5" class="text-center py-5 text-muted">
                <i class="bi bi-info-circle fs-2 d-block mb-2"></i>
                No se encontraron registros de movimientos.
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>